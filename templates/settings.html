{% extends "layout.html" %}

{% block title %}Settings - PUMP Music Player{% endblock %}

{% block content %}
{% set active_page = 'settings' %}
{% include 'partials/sidebar.html' %}
    
<div class="main-content">
    <h1>Settings</h1>
    
    {% if message %}
    <div class="message success">{{ message }}</div>
    {% endif %}
    
    {% if error %}
    <div class="message error">{{ error }}</div>
    {% endif %}
    
    <form method="post" class="settings-form">
        <!-- Music Library Configuration Section -->
        <div class="settings-section">
            <h2>Music Library</h2>
            <p>Configure your music folder and analyze your collection</p>
            
            <div class="settings-group">
                <div class="form-group">
                    <label for="music-directory">Music Folder Path:</label>
                    <input type="text" id="music-directory" name="music_folder_path" class="form-control" value="{{ music_folder_path }}" placeholder="/path/to/music">
                </div>
                
                <div class="form-group">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="recursive-scan" name="recursive" {% if recursive %}checked{% endif %}>
                        <label for="recursive-scan">Include subfolders when analyzing</label>
                    </div>
                </div>
                
                <div class="form-group button-group">
                    <button type="button" id="save-music-path" class="btn">Save Path</button>
                    <button type="button" id="quick-scan-btn" class="btn secondary-button">Quick Scan</button>
                    <button type="button" id="analyze-button" class="btn primary-button">Full Analysis</button>
                </div>
                
                <div id="analysis-status" class="status-container">
                    <div id="analysis-progress-bar" class="progress-bar">
                        <div id="analysis-progress-fill" class="progress-fill"></div>
                    </div>
                    <div id="analysis-status-text" class="status-text"></div>
                </div>
            </div>
        </div>
        
        <!-- Metadata Management -->
        <div class="settings-section">
            <h2>Metadata Management</h2>
            <p>Update track metadata from external services</p>
            
            <div class="settings-group">
                <div class="form-group button-group">
                    <button type="button" id="update-metadata-btn" class="btn secondary-button">Update Metadata</button>
                    <button type="button" id="update-lastfm-btn" class="btn secondary-button">Update via LastFM</button>
                    <button type="button" id="update-spotify-btn" class="btn secondary-button">Update via Spotify</button>
                </div>
                
                <div id="metadata-status" class="status-container">
                    <div id="metadata-status-text" class="status-text"></div>
                </div>
            </div>
        </div>
        
        <!-- Playlist Settings Section -->
        <div class="settings-section">
            <h2>Playlist Settings</h2>
            <div class="form-group">
                <label for="default_playlist_size">Default Station Size:</label>
                <select id="default_playlist_size" name="default_playlist_size" class="settings-select">
                    <option value="10" {% if default_playlist_size == '10' %}selected{% endif %}>10 tracks</option>
                    <option value="20" {% if default_playlist_size == '20' %}selected{% endif %}>20 tracks</option>
                    <option value="30" {% if default_playlist_size == '30' %}selected{% endif %}>30 tracks</option>
                    <option value="40" {% if default_playlist_size == '40' %}selected{% endif %}>40 tracks</option>
                    <option value="50" {% if default_playlist_size == '50' %}selected{% endif %}>50 tracks</option>
                    <option value="100" {% if default_playlist_size == '100' %}selected{% endif %}>100 tracks</option>
                </select>
                <p class="help-text">Number of tracks to include when creating a station</p>
            </div>
        </div>
        
        <!-- API Settings Section -->
        <div class="settings-section">
            <h2>External Services</h2>
            <p>Configure API keys for external services</p>
            
            <div class="settings-group">
                <h3>Last.fm API</h3>
                <div class="form-group">
                    <label for="lastfm_api_key">Last.fm API Key:</label>
                    <input type="text" id="lastfm_api_key" name="lastfm_api_key" value="{{ lastfm_api_key }}">
                </div>
                <div class="form-group">
                    <label for="lastfm_api_secret">Last.fm API Secret:</label>
                    <input type="text" id="lastfm_api_secret" name="lastfm_api_secret" value="{{ lastfm_api_secret }}">
                </div>
            </div>
            
            <div class="settings-group">
                <h3>Spotify API</h3>
                <div class="form-group">
                    <label for="spotify_client_id">Client ID:</label>
                    <input type="text" id="spotify_client_id" name="spotify_client_id" value="{{ spotify_client_id }}">
                </div>
                <div class="form-group">
                    <label for="spotify_client_secret">Client Secret:</label>
                    <input type="text" id="spotify_client_secret" name="spotify_client_secret" value="{{ spotify_client_secret }}">
                </div>
            </div>
            
            <div class="form-group button-group">
                <button type="button" id="test-api-connections" class="btn secondary-button">Test API Connections</button>
            </div>
        </div>
        
        <div class="form-group">
            <button type="submit" class="btn primary-button">Save All Settings</button>
        </div>
    </form>

    <!-- Album Art Cache Section -->
    <div class="settings-section">
        <h2>Album Art Cache</h2>
        <p>PUMP caches album art to improve performance and reduce external API calls</p>
        
        <div class="cache-stats">
            <div class="stats-loading">Loading cache statistics...</div>
        </div>
        
        <div class="button-group">
            <button type="button" id="clear-cache-btn" class="secondary-button">Clear Cache</button>
            <button type="button" id="refresh-stats-btn" class="secondary-button">Refresh Stats</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}

<head>
    <!-- ...existing code... -->
    <style>
        /* Add these styles to your existing CSS or add them to the head */
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>